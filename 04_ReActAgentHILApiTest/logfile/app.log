2025-10-30 10:41:32,265 - __main__ - INFO - Redis初始化成功
2025-10-30 10:41:32,432 - utils.llms - INFO - 成功初始化 openai LLM
2025-10-30 10:41:32,432 - __main__ - INFO - Chat模型初始化成功
2025-10-30 10:41:32,567 - __main__ - INFO - Checkpointer初始化成功
2025-10-30 10:41:34,123 - __main__ - INFO - Agent初始化成功
2025-10-30 10:41:34,123 - __main__ - INFO - 服务完成初始化并启动服务
2025-10-30 10:41:57,490 - __main__ - INFO - get_system_info接口，接受到前端用户请求
2025-10-30 10:41:57,495 - __main__ - INFO - 返回当前系统状态信息:sessions_count=0 active_users=[]
2025-10-30 10:41:59,558 - __main__ - INFO - get_agent_status接口，接受到前端用户请求:111
2025-10-30 10:41:59,562 - __main__ - ERROR - 用户 111 的会话不存在
2025-10-30 10:42:09,232 - __main__ - INFO - invoke_agent接口，接受到前端用户请求:user_id='111' query='成都今天的天气' system_message='你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。'
2025-10-30 10:42:10,321 - __main__ - ERROR - 处理请求时出错: session_id='e3a7683f-5950-4aee-a2a0-8feb12f200f9' status='error' timestamp=1761792130.321279 message="处理请求时出错: Error code: 401 - {'error': {'message': 'Invalid token (request id: 20251030104054836561394c9TGwRYR)', 'message_zh': '无效的令牌', 'type': 'new_api_error'}}" result=None interrupt_data=None
2025-10-30 10:42:10,350 - __main__ - INFO - get_agent_status接口，接受到前端用户请求:111
2025-10-30 10:42:10,354 - __main__ - INFO - 返回当前用户的状态:user_id='111' session_id='e3a7683f-5950-4aee-a2a0-8feb12f200f9' status='error' message=None last_query='成都今天的天气' last_updated=1761792130.3352032 last_response=AgentResponse(session_id='e3a7683f-5950-4aee-a2a0-8feb12f200f9', status='error', timestamp=1761792130.321279, message="处理请求时出错: Error code: 401 - {'error': {'message': 'Invalid token (request id: 20251030104054836561394c9TGwRYR)', 'message_zh': '无效的令牌', 'type': 'new_api_error'}}", result=None, interrupt_data=None)
2025-10-30 10:43:59,760 - __main__ - INFO - invoke_agent接口，接受到前端用户请求:user_id='111' query='北京的天气' system_message='你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。'
2025-10-30 10:44:00,850 - __main__ - ERROR - 处理请求时出错: session_id='e3a7683f-5950-4aee-a2a0-8feb12f200f9' status='error' timestamp=1761792240.849893 message="处理请求时出错: Error code: 401 - {'error': {'message': 'Invalid token (request id: 20251030104245368335283ibXTzA6n)', 'message_zh': '无效的令牌', 'type': 'new_api_error'}}" result=None interrupt_data=None
2025-10-30 10:44:00,869 - __main__ - INFO - get_agent_status接口，接受到前端用户请求:111
2025-10-30 10:44:00,873 - __main__ - INFO - 返回当前用户的状态:user_id='111' session_id='e3a7683f-5950-4aee-a2a0-8feb12f200f9' status='error' message=None last_query='北京的天气' last_updated=1761792240.8547578 last_response=AgentResponse(session_id='e3a7683f-5950-4aee-a2a0-8feb12f200f9', status='error', timestamp=1761792240.849893, message="处理请求时出错: Error code: 401 - {'error': {'message': 'Invalid token (request id: 20251030104245368335283ibXTzA6n)', 'message_zh': '无效的令牌', 'type': 'new_api_error'}}", result=None, interrupt_data=None)
2025-10-30 10:44:10,746 - __main__ - INFO - 关闭服务并完成资源清理
2025-10-30 10:45:05,758 - __main__ - INFO - Redis初始化成功
2025-10-30 10:45:05,914 - utils.llms - INFO - 成功初始化 openai LLM
2025-10-30 10:45:05,915 - __main__ - INFO - Chat模型初始化成功
2025-10-30 10:45:05,983 - __main__ - INFO - Checkpointer初始化成功
2025-10-30 10:45:07,514 - __main__ - INFO - Agent初始化成功
2025-10-30 10:45:07,514 - __main__ - INFO - 服务完成初始化并启动服务
2025-10-30 10:45:21,830 - __main__ - INFO - get_system_info接口，接受到前端用户请求
2025-10-30 10:45:21,836 - __main__ - INFO - 返回当前系统状态信息:sessions_count=1 active_users=['111']
2025-10-30 10:45:23,581 - __main__ - INFO - get_agent_status接口，接受到前端用户请求:111
2025-10-30 10:45:23,586 - __main__ - INFO - 返回当前用户的状态:user_id='111' session_id='e3a7683f-5950-4aee-a2a0-8feb12f200f9' status='error' message=None last_query='北京的天气' last_updated=1761792240.8547578 last_response=AgentResponse(session_id='e3a7683f-5950-4aee-a2a0-8feb12f200f9', status='error', timestamp=1761792240.849893, message="处理请求时出错: Error code: 401 - {'error': {'message': 'Invalid token (request id: 20251030104245368335283ibXTzA6n)', 'message_zh': '无效的令牌', 'type': 'new_api_error'}}", result=None, interrupt_data=None)
2025-10-30 10:45:31,816 - __main__ - INFO - invoke_agent接口，接受到前端用户请求:user_id='111' query='三亚的天气' system_message='你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。'
2025-10-30 10:45:32,893 - __main__ - ERROR - 处理请求时出错: session_id='e3a7683f-5950-4aee-a2a0-8feb12f200f9' status='error' timestamp=1761792332.893122 message="处理请求时出错: Error code: 401 - {'error': {'message': 'Invalid token (request id: 20251030104417402071601gQZQwRXN)', 'message_zh': '无效的令牌', 'type': 'new_api_error'}}" result=None interrupt_data=None
2025-10-30 10:45:32,920 - __main__ - INFO - get_agent_status接口，接受到前端用户请求:111
2025-10-30 10:45:32,925 - __main__ - INFO - 返回当前用户的状态:user_id='111' session_id='e3a7683f-5950-4aee-a2a0-8feb12f200f9' status='error' message=None last_query='三亚的天气' last_updated=1761792332.906903 last_response=AgentResponse(session_id='e3a7683f-5950-4aee-a2a0-8feb12f200f9', status='error', timestamp=1761792332.893122, message="处理请求时出错: Error code: 401 - {'error': {'message': 'Invalid token (request id: 20251030104417402071601gQZQwRXN)', 'message_zh': '无效的令牌', 'type': 'new_api_error'}}", result=None, interrupt_data=None)
2025-10-30 10:51:21,487 - __main__ - INFO - 关闭服务并完成资源清理
2025-10-30 10:51:29,294 - __main__ - INFO - Redis初始化成功
2025-10-30 10:51:29,296 - utils.llms - ERROR - LLM配置错误: 3 validation errors for ChatOpenAI
api_key.lax-or-strict[lax=json-or-python[json=function-after[SecretStr(), str],python=union[is-instance[SecretStr],function-after[SecretStr(), str]]],strict=json-or-python[json=function-after[SecretStr(), str],python=union[is-instance[SecretStr],function-after[SecretStr(), str]]]]
  Input should be a valid string [type=string_type, input_value=('sk-1253fd186be04092a68fb29559e689f3',), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.12/v/string_type
api_key.callable
  Input should be callable [type=callable_type, input_value=('sk-1253fd186be04092a68fb29559e689f3',), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.12/v/callable_type
api_key.callable
  Input should be callable [type=callable_type, input_value=('sk-1253fd186be04092a68fb29559e689f3',), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.12/v/callable_type
2025-10-30 10:51:29,297 - utils.llms - WARNING - 使用默认配置重试: LLM配置错误: 3 validation errors for ChatOpenAI
api_key.lax-or-strict[lax=json-or-python[json=function-after[SecretStr(), str],python=union[is-instance[SecretStr],function-after[SecretStr(), str]]],strict=json-or-python[json=function-after[SecretStr(), str],python=union[is-instance[SecretStr],function-after[SecretStr(), str]]]]
  Input should be a valid string [type=string_type, input_value=('sk-1253fd186be04092a68fb29559e689f3',), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.12/v/string_type
api_key.callable
  Input should be callable [type=callable_type, input_value=('sk-1253fd186be04092a68fb29559e689f3',), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.12/v/callable_type
api_key.callable
  Input should be callable [type=callable_type, input_value=('sk-1253fd186be04092a68fb29559e689f3',), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.12/v/callable_type
2025-10-30 10:51:29,297 - __main__ - ERROR - 初始化失败: LLM配置错误: 3 validation errors for ChatOpenAI
api_key.lax-or-strict[lax=json-or-python[json=function-after[SecretStr(), str],python=union[is-instance[SecretStr],function-after[SecretStr(), str]]],strict=json-or-python[json=function-after[SecretStr(), str],python=union[is-instance[SecretStr],function-after[SecretStr(), str]]]]
  Input should be a valid string [type=string_type, input_value=('sk-1253fd186be04092a68fb29559e689f3',), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.12/v/string_type
api_key.callable
  Input should be callable [type=callable_type, input_value=('sk-1253fd186be04092a68fb29559e689f3',), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.12/v/callable_type
api_key.callable
  Input should be callable [type=callable_type, input_value=('sk-1253fd186be04092a68fb29559e689f3',), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.12/v/callable_type
2025-10-30 10:59:16,909 - __main__ - INFO - Redis初始化成功
2025-10-30 10:59:16,910 - utils.llms - ERROR - LLM配置错误: 3 validation errors for ChatOpenAI
api_key.lax-or-strict[lax=json-or-python[json=function-after[SecretStr(), str],python=union[is-instance[SecretStr],function-after[SecretStr(), str]]],strict=json-or-python[json=function-after[SecretStr(), str],python=union[is-instance[SecretStr],function-after[SecretStr(), str]]]]
  Input should be a valid string [type=string_type, input_value=('sk-1253fd186be04092a68fb29559e689f3',), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.12/v/string_type
api_key.callable
  Input should be callable [type=callable_type, input_value=('sk-1253fd186be04092a68fb29559e689f3',), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.12/v/callable_type
api_key.callable
  Input should be callable [type=callable_type, input_value=('sk-1253fd186be04092a68fb29559e689f3',), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.12/v/callable_type
2025-10-30 10:59:16,911 - utils.llms - WARNING - 使用默认配置重试: LLM配置错误: 3 validation errors for ChatOpenAI
api_key.lax-or-strict[lax=json-or-python[json=function-after[SecretStr(), str],python=union[is-instance[SecretStr],function-after[SecretStr(), str]]],strict=json-or-python[json=function-after[SecretStr(), str],python=union[is-instance[SecretStr],function-after[SecretStr(), str]]]]
  Input should be a valid string [type=string_type, input_value=('sk-1253fd186be04092a68fb29559e689f3',), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.12/v/string_type
api_key.callable
  Input should be callable [type=callable_type, input_value=('sk-1253fd186be04092a68fb29559e689f3',), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.12/v/callable_type
api_key.callable
  Input should be callable [type=callable_type, input_value=('sk-1253fd186be04092a68fb29559e689f3',), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.12/v/callable_type
2025-10-30 10:59:16,911 - __main__ - ERROR - 初始化失败: LLM配置错误: 3 validation errors for ChatOpenAI
api_key.lax-or-strict[lax=json-or-python[json=function-after[SecretStr(), str],python=union[is-instance[SecretStr],function-after[SecretStr(), str]]],strict=json-or-python[json=function-after[SecretStr(), str],python=union[is-instance[SecretStr],function-after[SecretStr(), str]]]]
  Input should be a valid string [type=string_type, input_value=('sk-1253fd186be04092a68fb29559e689f3',), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.12/v/string_type
api_key.callable
  Input should be callable [type=callable_type, input_value=('sk-1253fd186be04092a68fb29559e689f3',), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.12/v/callable_type
api_key.callable
  Input should be callable [type=callable_type, input_value=('sk-1253fd186be04092a68fb29559e689f3',), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.12/v/callable_type
2025-10-30 11:02:14,428 - __main__ - INFO - Redis初始化成功
2025-10-30 11:02:14,429 - utils.llms - ERROR - LLM配置错误: 3 validation errors for ChatOpenAI
api_key.lax-or-strict[lax=json-or-python[json=function-after[SecretStr(), str],python=union[is-instance[SecretStr],function-after[SecretStr(), str]]],strict=json-or-python[json=function-after[SecretStr(), str],python=union[is-instance[SecretStr],function-after[SecretStr(), str]]]]
  Input should be a valid string [type=string_type, input_value=('sk-1253fd186be04092a68fb29559e689f3',), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.12/v/string_type
api_key.callable
  Input should be callable [type=callable_type, input_value=('sk-1253fd186be04092a68fb29559e689f3',), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.12/v/callable_type
api_key.callable
  Input should be callable [type=callable_type, input_value=('sk-1253fd186be04092a68fb29559e689f3',), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.12/v/callable_type
2025-10-30 11:02:14,430 - utils.llms - WARNING - 使用默认配置重试: LLM配置错误: 3 validation errors for ChatOpenAI
api_key.lax-or-strict[lax=json-or-python[json=function-after[SecretStr(), str],python=union[is-instance[SecretStr],function-after[SecretStr(), str]]],strict=json-or-python[json=function-after[SecretStr(), str],python=union[is-instance[SecretStr],function-after[SecretStr(), str]]]]
  Input should be a valid string [type=string_type, input_value=('sk-1253fd186be04092a68fb29559e689f3',), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.12/v/string_type
api_key.callable
  Input should be callable [type=callable_type, input_value=('sk-1253fd186be04092a68fb29559e689f3',), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.12/v/callable_type
api_key.callable
  Input should be callable [type=callable_type, input_value=('sk-1253fd186be04092a68fb29559e689f3',), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.12/v/callable_type
2025-10-30 11:02:14,430 - __main__ - ERROR - 初始化失败: LLM配置错误: 3 validation errors for ChatOpenAI
api_key.lax-or-strict[lax=json-or-python[json=function-after[SecretStr(), str],python=union[is-instance[SecretStr],function-after[SecretStr(), str]]],strict=json-or-python[json=function-after[SecretStr(), str],python=union[is-instance[SecretStr],function-after[SecretStr(), str]]]]
  Input should be a valid string [type=string_type, input_value=('sk-1253fd186be04092a68fb29559e689f3',), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.12/v/string_type
api_key.callable
  Input should be callable [type=callable_type, input_value=('sk-1253fd186be04092a68fb29559e689f3',), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.12/v/callable_type
api_key.callable
  Input should be callable [type=callable_type, input_value=('sk-1253fd186be04092a68fb29559e689f3',), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.12/v/callable_type
2025-10-30 20:49:02,385 - __main__ - INFO - Redis初始化成功
2025-10-30 20:49:02,386 - utils.llms - ERROR - LLM配置错误: 3 validation errors for ChatOpenAI
api_key.lax-or-strict[lax=json-or-python[json=function-after[SecretStr(), str],python=union[is-instance[SecretStr],function-after[SecretStr(), str]]],strict=json-or-python[json=function-after[SecretStr(), str],python=union[is-instance[SecretStr],function-after[SecretStr(), str]]]]
  Input should be a valid string [type=string_type, input_value=('sk-1253fd186be04092a68fb29559e689f3',), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.12/v/string_type
api_key.callable
  Input should be callable [type=callable_type, input_value=('sk-1253fd186be04092a68fb29559e689f3',), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.12/v/callable_type
api_key.callable
  Input should be callable [type=callable_type, input_value=('sk-1253fd186be04092a68fb29559e689f3',), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.12/v/callable_type
2025-10-30 20:49:02,388 - utils.llms - WARNING - 使用默认配置重试: LLM配置错误: 3 validation errors for ChatOpenAI
api_key.lax-or-strict[lax=json-or-python[json=function-after[SecretStr(), str],python=union[is-instance[SecretStr],function-after[SecretStr(), str]]],strict=json-or-python[json=function-after[SecretStr(), str],python=union[is-instance[SecretStr],function-after[SecretStr(), str]]]]
  Input should be a valid string [type=string_type, input_value=('sk-1253fd186be04092a68fb29559e689f3',), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.12/v/string_type
api_key.callable
  Input should be callable [type=callable_type, input_value=('sk-1253fd186be04092a68fb29559e689f3',), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.12/v/callable_type
api_key.callable
  Input should be callable [type=callable_type, input_value=('sk-1253fd186be04092a68fb29559e689f3',), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.12/v/callable_type
2025-10-30 20:49:02,388 - __main__ - ERROR - 初始化失败: LLM配置错误: 3 validation errors for ChatOpenAI
api_key.lax-or-strict[lax=json-or-python[json=function-after[SecretStr(), str],python=union[is-instance[SecretStr],function-after[SecretStr(), str]]],strict=json-or-python[json=function-after[SecretStr(), str],python=union[is-instance[SecretStr],function-after[SecretStr(), str]]]]
  Input should be a valid string [type=string_type, input_value=('sk-1253fd186be04092a68fb29559e689f3',), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.12/v/string_type
api_key.callable
  Input should be callable [type=callable_type, input_value=('sk-1253fd186be04092a68fb29559e689f3',), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.12/v/callable_type
api_key.callable
  Input should be callable [type=callable_type, input_value=('sk-1253fd186be04092a68fb29559e689f3',), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.12/v/callable_type
2025-10-30 20:51:31,263 - __main__ - INFO - Redis初始化成功
2025-10-30 20:51:31,428 - utils.llms - INFO - 成功初始化 qwen LLM
2025-10-30 20:51:31,428 - __main__ - INFO - Chat模型初始化成功
2025-10-30 20:51:31,507 - __main__ - INFO - Checkpointer初始化成功
2025-10-30 20:51:32,874 - __main__ - INFO - Agent初始化成功
2025-10-30 20:51:32,874 - __main__ - INFO - 服务完成初始化并启动服务
2025-10-30 20:51:40,131 - __main__ - INFO - invoke_agent接口，接受到前端用户请求:user_id='111' query='你好' system_message='你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。'
2025-10-30 20:51:41,192 - __main__ - INFO - 最终智能体回复结果:session_id='47daeabb-04b1-4465-a88d-f8df1d56ae76' status='completed' timestamp=1761828701.1924312 message=None result={'messages': [SystemMessage(content='你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。', additional_kwargs={}, response_metadata={}, id='ff266e01-305a-42b7-bf5b-07e7a88a1f1f'), HumanMessage(content='你好', additional_kwargs={}, response_metadata={}, id='d9685582-1ab2-4cc9-842a-5565e1f51674'), AIMessage(content='你好！有什么我可以帮助你的吗？', additional_kwargs={'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 8, 'prompt_tokens': 2287, 'total_tokens': 2295, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 0}}, 'model_provider': 'openai', 'model_name': 'qwen-turbo', 'system_fingerprint': None, 'id': 'chatcmpl-f63bcb03-5d53-4f9a-8da3-e73e4a17dfb1', 'finish_reason': 'stop', 'logprobs': None}, id='lc_run--f7b8d668-db4f-4f8a-b8dc-433266ce3193-0', usage_metadata={'input_tokens': 2287, 'output_tokens': 8, 'total_tokens': 2295, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}})]} interrupt_data=None
2025-10-30 20:51:41,210 - __main__ - INFO - get_agent_status接口，接受到前端用户请求:111
2025-10-30 20:51:41,215 - __main__ - INFO - 返回当前用户的状态:user_id='111' session_id='47daeabb-04b1-4465-a88d-f8df1d56ae76' status='completed' message=None last_query='你好' last_updated=1761828701.195244 last_response=AgentResponse(session_id='47daeabb-04b1-4465-a88d-f8df1d56ae76', status='completed', timestamp=1761828701.1924312, message=None, result={'messages': [{'content': '你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'system', 'name': None, 'id': 'ff266e01-305a-42b7-bf5b-07e7a88a1f1f'}, {'content': '你好', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'human', 'name': None, 'id': 'd9685582-1ab2-4cc9-842a-5565e1f51674'}, {'content': '你好！有什么我可以帮助你的吗？', 'additional_kwargs': {'refusal': None}, 'response_metadata': {'token_usage': {'completion_tokens': 8, 'prompt_tokens': 2287, 'total_tokens': 2295, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 0}}, 'model_provider': 'openai', 'model_name': 'qwen-turbo', 'system_fingerprint': None, 'id': 'chatcmpl-f63bcb03-5d53-4f9a-8da3-e73e4a17dfb1', 'finish_reason': 'stop', 'logprobs': None}, 'type': 'ai', 'name': None, 'id': 'lc_run--f7b8d668-db4f-4f8a-b8dc-433266ce3193-0', 'tool_calls': [], 'invalid_tool_calls': [], 'usage_metadata': {'input_tokens': 2287, 'output_tokens': 8, 'total_tokens': 2295, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}}]}, interrupt_data=None)
2025-10-30 20:51:41,222 - __main__ - INFO - invoke_agent接口，接受到前端用户请求:user_id='111' query='你好' system_message='你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。'
2025-10-30 20:51:41,599 - __main__ - INFO - 最终智能体回复结果:session_id='47daeabb-04b1-4465-a88d-f8df1d56ae76' status='completed' timestamp=1761828701.598809 message=None result={'messages': [SystemMessage(content='你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。', additional_kwargs={}, response_metadata={}, id='ff266e01-305a-42b7-bf5b-07e7a88a1f1f'), HumanMessage(content='你好', additional_kwargs={}, response_metadata={}, id='d9685582-1ab2-4cc9-842a-5565e1f51674'), AIMessage(content='你好！有什么我可以帮助你的吗？', additional_kwargs={'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 8, 'prompt_tokens': 2287, 'total_tokens': 2295, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 0}}, 'model_provider': 'openai', 'model_name': 'qwen-turbo', 'system_fingerprint': None, 'id': 'chatcmpl-f63bcb03-5d53-4f9a-8da3-e73e4a17dfb1', 'finish_reason': 'stop', 'logprobs': None}, id='lc_run--f7b8d668-db4f-4f8a-b8dc-433266ce3193-0', usage_metadata={'input_tokens': 2287, 'output_tokens': 8, 'total_tokens': 2295, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}), SystemMessage(content='你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。', additional_kwargs={}, response_metadata={}, id='a74ec682-a281-4033-88b6-dc7d5d2ec746'), HumanMessage(content='你好', additional_kwargs={}, response_metadata={}, id='f46ab863-55f3-46d1-96be-3c0a2ba817ff'), AIMessage(content='你好！有什么我可以帮助你的吗？', additional_kwargs={'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 8, 'prompt_tokens': 2322, 'total_tokens': 2330, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 2048}}, 'model_provider': 'openai', 'model_name': 'qwen-turbo', 'system_fingerprint': None, 'id': 'chatcmpl-894f1f56-552c-467a-b1d2-84da0c427ca2', 'finish_reason': 'stop', 'logprobs': None}, id='lc_run--8e11b792-f2ec-483d-9af1-0a62973033f7-0', usage_metadata={'input_tokens': 2322, 'output_tokens': 8, 'total_tokens': 2330, 'input_token_details': {'cache_read': 2048}, 'output_token_details': {}})]} interrupt_data=None
2025-10-30 20:51:41,620 - __main__ - INFO - get_agent_status接口，接受到前端用户请求:111
2025-10-30 20:51:41,624 - __main__ - INFO - 返回当前用户的状态:user_id='111' session_id='47daeabb-04b1-4465-a88d-f8df1d56ae76' status='completed' message=None last_query='你好' last_updated=1761828701.602713 last_response=AgentResponse(session_id='47daeabb-04b1-4465-a88d-f8df1d56ae76', status='completed', timestamp=1761828701.598809, message=None, result={'messages': [{'content': '你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'system', 'name': None, 'id': 'ff266e01-305a-42b7-bf5b-07e7a88a1f1f'}, {'content': '你好', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'human', 'name': None, 'id': 'd9685582-1ab2-4cc9-842a-5565e1f51674'}, {'content': '你好！有什么我可以帮助你的吗？', 'additional_kwargs': {'refusal': None}, 'response_metadata': {'token_usage': {'completion_tokens': 8, 'prompt_tokens': 2287, 'total_tokens': 2295, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 0}}, 'model_provider': 'openai', 'model_name': 'qwen-turbo', 'system_fingerprint': None, 'id': 'chatcmpl-f63bcb03-5d53-4f9a-8da3-e73e4a17dfb1', 'finish_reason': 'stop', 'logprobs': None}, 'type': 'ai', 'name': None, 'id': 'lc_run--f7b8d668-db4f-4f8a-b8dc-433266ce3193-0', 'tool_calls': [], 'invalid_tool_calls': [], 'usage_metadata': {'input_tokens': 2287, 'output_tokens': 8, 'total_tokens': 2295, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}}, {'content': '你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'system', 'name': None, 'id': 'a74ec682-a281-4033-88b6-dc7d5d2ec746'}, {'content': '你好', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'human', 'name': None, 'id': 'f46ab863-55f3-46d1-96be-3c0a2ba817ff'}, {'content': '你好！有什么我可以帮助你的吗？', 'additional_kwargs': {'refusal': None}, 'response_metadata': {'token_usage': {'completion_tokens': 8, 'prompt_tokens': 2322, 'total_tokens': 2330, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 2048}}, 'model_provider': 'openai', 'model_name': 'qwen-turbo', 'system_fingerprint': None, 'id': 'chatcmpl-894f1f56-552c-467a-b1d2-84da0c427ca2', 'finish_reason': 'stop', 'logprobs': None}, 'type': 'ai', 'name': None, 'id': 'lc_run--8e11b792-f2ec-483d-9af1-0a62973033f7-0', 'tool_calls': [], 'invalid_tool_calls': [], 'usage_metadata': {'input_tokens': 2322, 'output_tokens': 8, 'total_tokens': 2330, 'input_token_details': {'cache_read': 2048}, 'output_token_details': {}}}]}, interrupt_data=None)
2025-10-30 20:51:41,632 - __main__ - INFO - invoke_agent接口，接受到前端用户请求:user_id='111' query='你好' system_message='你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。'
2025-10-30 20:51:42,123 - __main__ - INFO - 最终智能体回复结果:session_id='47daeabb-04b1-4465-a88d-f8df1d56ae76' status='completed' timestamp=1761828702.123432 message=None result={'messages': [SystemMessage(content='你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。', additional_kwargs={}, response_metadata={}, id='ff266e01-305a-42b7-bf5b-07e7a88a1f1f'), HumanMessage(content='你好', additional_kwargs={}, response_metadata={}, id='d9685582-1ab2-4cc9-842a-5565e1f51674'), AIMessage(content='你好！有什么我可以帮助你的吗？', additional_kwargs={'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 8, 'prompt_tokens': 2287, 'total_tokens': 2295, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 0}}, 'model_provider': 'openai', 'model_name': 'qwen-turbo', 'system_fingerprint': None, 'id': 'chatcmpl-f63bcb03-5d53-4f9a-8da3-e73e4a17dfb1', 'finish_reason': 'stop', 'logprobs': None}, id='lc_run--f7b8d668-db4f-4f8a-b8dc-433266ce3193-0', usage_metadata={'input_tokens': 2287, 'output_tokens': 8, 'total_tokens': 2295, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}), SystemMessage(content='你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。', additional_kwargs={}, response_metadata={}, id='a74ec682-a281-4033-88b6-dc7d5d2ec746'), HumanMessage(content='你好', additional_kwargs={}, response_metadata={}, id='f46ab863-55f3-46d1-96be-3c0a2ba817ff'), AIMessage(content='你好！有什么我可以帮助你的吗？', additional_kwargs={'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 8, 'prompt_tokens': 2322, 'total_tokens': 2330, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 2048}}, 'model_provider': 'openai', 'model_name': 'qwen-turbo', 'system_fingerprint': None, 'id': 'chatcmpl-894f1f56-552c-467a-b1d2-84da0c427ca2', 'finish_reason': 'stop', 'logprobs': None}, id='lc_run--8e11b792-f2ec-483d-9af1-0a62973033f7-0', usage_metadata={'input_tokens': 2322, 'output_tokens': 8, 'total_tokens': 2330, 'input_token_details': {'cache_read': 2048}, 'output_token_details': {}}), SystemMessage(content='你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。', additional_kwargs={}, response_metadata={}, id='a6f13e10-f894-4b60-aa9e-632785594844'), HumanMessage(content='你好', additional_kwargs={}, response_metadata={}, id='02924e03-0a48-4f43-b049-319d5ec7ed0b'), AIMessage(content='你好！有什么我可以帮助你的吗？', additional_kwargs={'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 8, 'prompt_tokens': 2357, 'total_tokens': 2365, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 2304}}, 'model_provider': 'openai', 'model_name': 'qwen-turbo', 'system_fingerprint': None, 'id': 'chatcmpl-e1f8f996-83da-4243-b5ec-7ca7da156444', 'finish_reason': 'stop', 'logprobs': None}, id='lc_run--37a53a29-85be-46af-9758-4dd684bcf844-0', usage_metadata={'input_tokens': 2357, 'output_tokens': 8, 'total_tokens': 2365, 'input_token_details': {'cache_read': 2304}, 'output_token_details': {}})]} interrupt_data=None
2025-10-30 20:51:42,138 - __main__ - INFO - get_agent_status接口，接受到前端用户请求:111
2025-10-30 20:51:42,142 - __main__ - INFO - 返回当前用户的状态:user_id='111' session_id='47daeabb-04b1-4465-a88d-f8df1d56ae76' status='completed' message=None last_query='你好' last_updated=1761828702.125539 last_response=AgentResponse(session_id='47daeabb-04b1-4465-a88d-f8df1d56ae76', status='completed', timestamp=1761828702.123432, message=None, result={'messages': [{'content': '你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'system', 'name': None, 'id': 'ff266e01-305a-42b7-bf5b-07e7a88a1f1f'}, {'content': '你好', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'human', 'name': None, 'id': 'd9685582-1ab2-4cc9-842a-5565e1f51674'}, {'content': '你好！有什么我可以帮助你的吗？', 'additional_kwargs': {'refusal': None}, 'response_metadata': {'token_usage': {'completion_tokens': 8, 'prompt_tokens': 2287, 'total_tokens': 2295, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 0}}, 'model_provider': 'openai', 'model_name': 'qwen-turbo', 'system_fingerprint': None, 'id': 'chatcmpl-f63bcb03-5d53-4f9a-8da3-e73e4a17dfb1', 'finish_reason': 'stop', 'logprobs': None}, 'type': 'ai', 'name': None, 'id': 'lc_run--f7b8d668-db4f-4f8a-b8dc-433266ce3193-0', 'tool_calls': [], 'invalid_tool_calls': [], 'usage_metadata': {'input_tokens': 2287, 'output_tokens': 8, 'total_tokens': 2295, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}}, {'content': '你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'system', 'name': None, 'id': 'a74ec682-a281-4033-88b6-dc7d5d2ec746'}, {'content': '你好', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'human', 'name': None, 'id': 'f46ab863-55f3-46d1-96be-3c0a2ba817ff'}, {'content': '你好！有什么我可以帮助你的吗？', 'additional_kwargs': {'refusal': None}, 'response_metadata': {'token_usage': {'completion_tokens': 8, 'prompt_tokens': 2322, 'total_tokens': 2330, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 2048}}, 'model_provider': 'openai', 'model_name': 'qwen-turbo', 'system_fingerprint': None, 'id': 'chatcmpl-894f1f56-552c-467a-b1d2-84da0c427ca2', 'finish_reason': 'stop', 'logprobs': None}, 'type': 'ai', 'name': None, 'id': 'lc_run--8e11b792-f2ec-483d-9af1-0a62973033f7-0', 'tool_calls': [], 'invalid_tool_calls': [], 'usage_metadata': {'input_tokens': 2322, 'output_tokens': 8, 'total_tokens': 2330, 'input_token_details': {'cache_read': 2048}, 'output_token_details': {}}}, {'content': '你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'system', 'name': None, 'id': 'a6f13e10-f894-4b60-aa9e-632785594844'}, {'content': '你好', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'human', 'name': None, 'id': '02924e03-0a48-4f43-b049-319d5ec7ed0b'}, {'content': '你好！有什么我可以帮助你的吗？', 'additional_kwargs': {'refusal': None}, 'response_metadata': {'token_usage': {'completion_tokens': 8, 'prompt_tokens': 2357, 'total_tokens': 2365, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 2304}}, 'model_provider': 'openai', 'model_name': 'qwen-turbo', 'system_fingerprint': None, 'id': 'chatcmpl-e1f8f996-83da-4243-b5ec-7ca7da156444', 'finish_reason': 'stop', 'logprobs': None}, 'type': 'ai', 'name': None, 'id': 'lc_run--37a53a29-85be-46af-9758-4dd684bcf844-0', 'tool_calls': [], 'invalid_tool_calls': [], 'usage_metadata': {'input_tokens': 2357, 'output_tokens': 8, 'total_tokens': 2365, 'input_token_details': {'cache_read': 2304}, 'output_token_details': {}}}]}, interrupt_data=None)
2025-10-30 20:51:47,986 - __main__ - INFO - get_system_info接口，接受到前端用户请求
2025-10-30 20:51:47,989 - __main__ - INFO - 返回当前系统状态信息:sessions_count=1 active_users=['111']
2025-10-30 20:51:50,108 - __main__ - INFO - get_agent_status接口，接受到前端用户请求:123
2025-10-30 20:51:50,111 - __main__ - ERROR - 用户 123 的会话不存在
2025-10-30 20:51:59,399 - __main__ - INFO - invoke_agent接口，接受到前端用户请求:user_id='123' query='今天的天气怎样' system_message='你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。'
2025-10-30 20:52:00,251 - __main__ - INFO - 最终智能体回复结果:session_id='a700fd98-5167-44e9-ac84-187eafbb88bc' status='completed' timestamp=1761828720.251253 message=None result={'messages': [SystemMessage(content='你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。', additional_kwargs={}, response_metadata={}, id='f6604bea-8a68-4113-ba47-b385604cfab3'), HumanMessage(content='今天的天气怎样', additional_kwargs={}, response_metadata={}, id='525852d1-239b-434a-a473-d649a332100e'), AIMessage(content='请提供城市名称或adcode，以便查询该城市的天气情况。', additional_kwargs={'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 15, 'prompt_tokens': 2289, 'total_tokens': 2304, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 0}}, 'model_provider': 'openai', 'model_name': 'qwen-turbo', 'system_fingerprint': None, 'id': 'chatcmpl-f7b69996-5ddd-41f6-af99-75fcb0d95e56', 'finish_reason': 'stop', 'logprobs': None}, id='lc_run--f331787e-7fb6-499e-91b9-57cae0f17a66-0', usage_metadata={'input_tokens': 2289, 'output_tokens': 15, 'total_tokens': 2304, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}})]} interrupt_data=None
2025-10-30 20:52:00,266 - __main__ - INFO - get_agent_status接口，接受到前端用户请求:123
2025-10-30 20:52:00,270 - __main__ - INFO - 返回当前用户的状态:user_id='123' session_id='a700fd98-5167-44e9-ac84-187eafbb88bc' status='completed' message=None last_query='今天的天气怎样' last_updated=1761828720.253821 last_response=AgentResponse(session_id='a700fd98-5167-44e9-ac84-187eafbb88bc', status='completed', timestamp=1761828720.251253, message=None, result={'messages': [{'content': '你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'system', 'name': None, 'id': 'f6604bea-8a68-4113-ba47-b385604cfab3'}, {'content': '今天的天气怎样', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'human', 'name': None, 'id': '525852d1-239b-434a-a473-d649a332100e'}, {'content': '请提供城市名称或adcode，以便查询该城市的天气情况。', 'additional_kwargs': {'refusal': None}, 'response_metadata': {'token_usage': {'completion_tokens': 15, 'prompt_tokens': 2289, 'total_tokens': 2304, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 0}}, 'model_provider': 'openai', 'model_name': 'qwen-turbo', 'system_fingerprint': None, 'id': 'chatcmpl-f7b69996-5ddd-41f6-af99-75fcb0d95e56', 'finish_reason': 'stop', 'logprobs': None}, 'type': 'ai', 'name': None, 'id': 'lc_run--f331787e-7fb6-499e-91b9-57cae0f17a66-0', 'tool_calls': [], 'invalid_tool_calls': [], 'usage_metadata': {'input_tokens': 2289, 'output_tokens': 15, 'total_tokens': 2304, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}}]}, interrupt_data=None)
2025-10-30 20:52:08,962 - __main__ - INFO - invoke_agent接口，接受到前端用户请求:user_id='123' query='成都' system_message='你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。'
2025-10-30 20:52:09,753 - __main__ - INFO - 当前触发工具调用中断:session_id='a700fd98-5167-44e9-ac84-187eafbb88bc' status='interrupted' timestamp=1761828729.753109 message=None result=None interrupt_data={'action_request': {'action': 'maps_weather', 'args': {'city': '成都'}}, 'config': None, 'description': "准备调用 maps_weather 工具：\n- 参数为: {'city': '成都'}\n\n是否允许继续？\n输入 'yes' 接受工具调用\n输入 'no' 拒绝工具调用\n输入 'edit' 修改工具参数后调用工具\n输入 'response' 不调用工具直接反馈信息", 'interrupt_type': 'unknown'}
2025-10-30 20:52:12,290 - __main__ - INFO - resume_agent接口，接受到前端用户请求:user_id='123' session_id='a700fd98-5167-44e9-ac84-187eafbb88bc' response_type='accept' args=None
2025-10-30 20:52:12,311 - utils.tools - INFO - response: {'type': 'accept'}
2025-10-30 20:52:12,312 - utils.tools - INFO - 工具调用已批准，执行中...
2025-10-30 20:52:12,312 - utils.tools - INFO - 调用工具: maps_weather, 参数: {'city': '成都'}
2025-10-30 20:52:14,319 - utils.tools - INFO - {"city":"成都市","forecasts":[{"date":"2025-10-30","week":"4","dayweather":"阴","nightweather":"小雨","daytemp":"20","nighttemp":"15","daywind":"东南","nightwind":"东南","daypower":"1-3","nightpower":"1-3","daytemp_float":"20.0","nighttemp_float":"15.0"},{"date":"2025-10-31","week":"5","dayweather":"小雨","nightweather":"小雨","daytemp":"17","nighttemp":"14","daywind":"北","nightwind":"北","daypower":"1-3","nightpower":"1-3","daytemp_float":"17.0","nighttemp_float":"14.0"},{"date":"2025-11-01","week":"6","dayweather":"小雨","nightweather":"小雨","daytemp":"16","nighttemp":"13","daywind":"西南","nightwind":"西南","daypower":"1-3","nightpower":"1-3","daytemp_float":"16.0","nighttemp_float":"13.0"},{"date":"2025-11-02","week":"7","dayweather":"小雨","nightweather":"小雨","daytemp":"15","nighttemp":"12","daywind":"东","nightwind":"东","daypower":"1-3","nightpower":"1-3","daytemp_float":"15.0","nighttemp_float":"12.0"}]}
2025-10-30 20:52:16,846 - __main__ - INFO - 最终智能体回复结果:session_id='a700fd98-5167-44e9-ac84-187eafbb88bc' status='completed' timestamp=1761828736.8463502 message=None result={'messages': [SystemMessage(content='你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。', additional_kwargs={}, response_metadata={}, id='f6604bea-8a68-4113-ba47-b385604cfab3'), HumanMessage(content='今天的天气怎样', additional_kwargs={}, response_metadata={}, id='525852d1-239b-434a-a473-d649a332100e'), AIMessage(content='请提供城市名称或adcode，以便查询该城市的天气情况。', additional_kwargs={'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 15, 'prompt_tokens': 2289, 'total_tokens': 2304, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 0}}, 'model_provider': 'openai', 'model_name': 'qwen-turbo', 'system_fingerprint': None, 'id': 'chatcmpl-f7b69996-5ddd-41f6-af99-75fcb0d95e56', 'finish_reason': 'stop', 'logprobs': None}, id='lc_run--f331787e-7fb6-499e-91b9-57cae0f17a66-0', usage_metadata={'input_tokens': 2289, 'output_tokens': 15, 'total_tokens': 2304, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}), SystemMessage(content='你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。', additional_kwargs={}, response_metadata={}, id='c071ae43-e073-404f-8091-1b5bd12cdffe'), HumanMessage(content='成都', additional_kwargs={}, response_metadata={}, id='8f2c98f0-5d75-41d2-95cd-f85fdf276135'), AIMessage(content='', additional_kwargs={'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 19, 'prompt_tokens': 2331, 'total_tokens': 2350, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 0}}, 'model_provider': 'openai', 'model_name': 'qwen-turbo', 'system_fingerprint': None, 'id': 'chatcmpl-bf76d39f-ce48-4847-b258-9617f903c66c', 'finish_reason': 'tool_calls', 'logprobs': None}, id='lc_run--1ba4e564-6490-4e7d-9b52-4dae39c8e362-0', tool_calls=[{'name': 'maps_weather', 'args': {'city': '成都'}, 'id': 'call_fbfd6aacc3b9432e986faa', 'type': 'tool_call'}], usage_metadata={'input_tokens': 2331, 'output_tokens': 19, 'total_tokens': 2350, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}), ToolMessage(content='{"city":"成都市","forecasts":[{"date":"2025-10-30","week":"4","dayweather":"阴","nightweather":"小雨","daytemp":"20","nighttemp":"15","daywind":"东南","nightwind":"东南","daypower":"1-3","nightpower":"1-3","daytemp_float":"20.0","nighttemp_float":"15.0"},{"date":"2025-10-31","week":"5","dayweather":"小雨","nightweather":"小雨","daytemp":"17","nighttemp":"14","daywind":"北","nightwind":"北","daypower":"1-3","nightpower":"1-3","daytemp_float":"17.0","nighttemp_float":"14.0"},{"date":"2025-11-01","week":"6","dayweather":"小雨","nightweather":"小雨","daytemp":"16","nighttemp":"13","daywind":"西南","nightwind":"西南","daypower":"1-3","nightpower":"1-3","daytemp_float":"16.0","nighttemp_float":"13.0"},{"date":"2025-11-02","week":"7","dayweather":"小雨","nightweather":"小雨","daytemp":"15","nighttemp":"12","daywind":"东","nightwind":"东","daypower":"1-3","nightpower":"1-3","daytemp_float":"15.0","nighttemp_float":"12.0"}]}', name='maps_weather', id='6c4e23f7-cd22-497f-b111-95997add535f', tool_call_id='call_fbfd6aacc3b9432e986faa'), AIMessage(content='今天是2025年10月30日，成都市的天气情况如下：\n\n- 白天：阴天，气温20°C，东南风，风力1-3级。\n- 夜间：小雨，气温15°C，东南风，风力1-3级。\n\n明天（2025年10月31日）：\n- 白天：小雨，气温17°C，北风，风力1-3级。\n- 夜间：小雨，气温14°C，北风，风力1-3级。\n\n后续几天的天气也以小雨为主，气温逐渐下降，请注意保暖和携带雨具。', additional_kwargs={'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 148, 'prompt_tokens': 2703, 'total_tokens': 2851, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 2048}}, 'model_provider': 'openai', 'model_name': 'qwen-turbo', 'system_fingerprint': None, 'id': 'chatcmpl-346042da-86bb-408a-9969-7e9db1f09eb8', 'finish_reason': 'stop', 'logprobs': None}, id='lc_run--cb84c997-547a-456b-8308-10c41af35bf3-0', usage_metadata={'input_tokens': 2703, 'output_tokens': 148, 'total_tokens': 2851, 'input_token_details': {'cache_read': 2048}, 'output_token_details': {}})]} interrupt_data=None
2025-10-30 20:52:16,866 - __main__ - INFO - get_agent_status接口，接受到前端用户请求:123
2025-10-30 20:52:16,872 - __main__ - INFO - 返回当前用户的状态:user_id='123' session_id='a700fd98-5167-44e9-ac84-187eafbb88bc' status='completed' message=None last_query='成都' last_updated=1761828736.850132 last_response=AgentResponse(session_id='a700fd98-5167-44e9-ac84-187eafbb88bc', status='completed', timestamp=1761828736.8463502, message=None, result={'messages': [{'content': '你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'system', 'name': None, 'id': 'f6604bea-8a68-4113-ba47-b385604cfab3'}, {'content': '今天的天气怎样', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'human', 'name': None, 'id': '525852d1-239b-434a-a473-d649a332100e'}, {'content': '请提供城市名称或adcode，以便查询该城市的天气情况。', 'additional_kwargs': {'refusal': None}, 'response_metadata': {'token_usage': {'completion_tokens': 15, 'prompt_tokens': 2289, 'total_tokens': 2304, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 0}}, 'model_provider': 'openai', 'model_name': 'qwen-turbo', 'system_fingerprint': None, 'id': 'chatcmpl-f7b69996-5ddd-41f6-af99-75fcb0d95e56', 'finish_reason': 'stop', 'logprobs': None}, 'type': 'ai', 'name': None, 'id': 'lc_run--f331787e-7fb6-499e-91b9-57cae0f17a66-0', 'tool_calls': [], 'invalid_tool_calls': [], 'usage_metadata': {'input_tokens': 2289, 'output_tokens': 15, 'total_tokens': 2304, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}}, {'content': '你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'system', 'name': None, 'id': 'c071ae43-e073-404f-8091-1b5bd12cdffe'}, {'content': '成都', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'human', 'name': None, 'id': '8f2c98f0-5d75-41d2-95cd-f85fdf276135'}, {'content': '', 'additional_kwargs': {'refusal': None}, 'response_metadata': {'token_usage': {'completion_tokens': 19, 'prompt_tokens': 2331, 'total_tokens': 2350, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 0}}, 'model_provider': 'openai', 'model_name': 'qwen-turbo', 'system_fingerprint': None, 'id': 'chatcmpl-bf76d39f-ce48-4847-b258-9617f903c66c', 'finish_reason': 'tool_calls', 'logprobs': None}, 'type': 'ai', 'name': None, 'id': 'lc_run--1ba4e564-6490-4e7d-9b52-4dae39c8e362-0', 'tool_calls': [{'name': 'maps_weather', 'args': {'city': '成都'}, 'id': 'call_fbfd6aacc3b9432e986faa', 'type': 'tool_call'}], 'invalid_tool_calls': [], 'usage_metadata': {'input_tokens': 2331, 'output_tokens': 19, 'total_tokens': 2350, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}}, {'content': '{"city":"成都市","forecasts":[{"date":"2025-10-30","week":"4","dayweather":"阴","nightweather":"小雨","daytemp":"20","nighttemp":"15","daywind":"东南","nightwind":"东南","daypower":"1-3","nightpower":"1-3","daytemp_float":"20.0","nighttemp_float":"15.0"},{"date":"2025-10-31","week":"5","dayweather":"小雨","nightweather":"小雨","daytemp":"17","nighttemp":"14","daywind":"北","nightwind":"北","daypower":"1-3","nightpower":"1-3","daytemp_float":"17.0","nighttemp_float":"14.0"},{"date":"2025-11-01","week":"6","dayweather":"小雨","nightweather":"小雨","daytemp":"16","nighttemp":"13","daywind":"西南","nightwind":"西南","daypower":"1-3","nightpower":"1-3","daytemp_float":"16.0","nighttemp_float":"13.0"},{"date":"2025-11-02","week":"7","dayweather":"小雨","nightweather":"小雨","daytemp":"15","nighttemp":"12","daywind":"东","nightwind":"东","daypower":"1-3","nightpower":"1-3","daytemp_float":"15.0","nighttemp_float":"12.0"}]}', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'tool', 'name': 'maps_weather', 'id': '6c4e23f7-cd22-497f-b111-95997add535f', 'tool_call_id': 'call_fbfd6aacc3b9432e986faa', 'artifact': None, 'status': 'success'}, {'content': '今天是2025年10月30日，成都市的天气情况如下：\n\n- 白天：阴天，气温20°C，东南风，风力1-3级。\n- 夜间：小雨，气温15°C，东南风，风力1-3级。\n\n明天（2025年10月31日）：\n- 白天：小雨，气温17°C，北风，风力1-3级。\n- 夜间：小雨，气温14°C，北风，风力1-3级。\n\n后续几天的天气也以小雨为主，气温逐渐下降，请注意保暖和携带雨具。', 'additional_kwargs': {'refusal': None}, 'response_metadata': {'token_usage': {'completion_tokens': 148, 'prompt_tokens': 2703, 'total_tokens': 2851, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 2048}}, 'model_provider': 'openai', 'model_name': 'qwen-turbo', 'system_fingerprint': None, 'id': 'chatcmpl-346042da-86bb-408a-9969-7e9db1f09eb8', 'finish_reason': 'stop', 'logprobs': None}, 'type': 'ai', 'name': None, 'id': 'lc_run--cb84c997-547a-456b-8308-10c41af35bf3-0', 'tool_calls': [], 'invalid_tool_calls': [], 'usage_metadata': {'input_tokens': 2703, 'output_tokens': 148, 'total_tokens': 2851, 'input_token_details': {'cache_read': 2048}, 'output_token_details': {}}}]}, interrupt_data=None)
2025-10-30 20:53:56,977 - __main__ - INFO - 关闭服务并完成资源清理
